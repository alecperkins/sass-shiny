<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <style>
        body {
            max-width       : 760px;
            margin          : 0 auto;
            padding         : 1em;
            color           : #0c0c0c;
        }
        p code {
            border          : 1px solid #ccc;
            padding         : 0.25em 0.5em;
        }
        h1, h2, h3, h4, h5, h6 {
            position        : relative;
        }
        .deeplink {
            position        : absolute;
            right           : 100%;
            margin-right    : 0.5rem;
            color           : #ccc;
            text-decoration : none;
        }
    </style>
</head>
<body>
    <nav>
        <a href="./">Index</a>
        <a href="./spec.html">Specification</a>
        <a href="./helpers.html">Helpers</a>
    </nav>

    <%= content %>

    <script>
        (function(){
            var heading_counts = {};
            var heading_stack = []
            var heading_els = document.querySelectorAll('h1, h2, h3, h4, h5, h6');
            for(var i = 0; i < heading_els.length; i++) {
                var current_heading = heading_els[i];
                current_heading.level = parseInt(current_heading.tagName.substring(1));
                while(heading_stack[heading_stack.length - 1] && heading_stack[heading_stack.length - 1].level >= current_heading.level) {
                    heading_stack.pop()
                }
                heading_stack.push(current_heading);
                var parent_id = '';
                if(heading_stack.length > 1) {
                    parent_id = heading_stack[heading_stack.length - 2].id;
                }
                var text = current_heading.innerText;
                var slug = text.toLowerCase().replace(/[\W]+/g,'-').split(/\s/).join('-');
                if(slug[0] === '-') {
                    slug = slug.substring(1);
                }
                if(slug[slug.length - 1] === '-') {
                    slug = slug.slice(0, slug.length - 1);
                }
                slug = parent_id + '/' + slug;
                if(!heading_counts[slug]) {
                    heading_counts[slug] = 0;
                }
                heading_counts[slug]++;
                if(heading_counts[slug] > 1) {
                    slug = slug + '-' + heading_counts[slug].toString()
                }
                current_heading.id = slug;
                current_heading.innerHTML = '<a class="deeplink" href="#' + slug + '">#</a>' + current_heading.innerHTML
            }
        })();
    </script>
    <script type="text/javascript">
      var _gauges = _gauges || [];
      (function() {
        var t   = document.createElement('script');
        t.type  = 'text/javascript';
        t.async = true;
        t.id    = 'gauges-tracker';
        t.setAttribute('data-site-id', '529e667f8bfdf7747e000052');
        t.src = '//secure.gaug.es/track.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(t, s);
      })();
    </script>
</body>
</html>